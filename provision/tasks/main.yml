---
# tasks file for provision
- block:
  - include_vars: ../ovirt_Password.yml

  - name: Obtain SSO token using username/password creds.
    ovirt_auth:
      url: https://rhvm.internal.croftvillas.com/ovirt-engine/api
      username: admin@internal
      ca_file: ../pki-resource.cer
      password: "{{ ovirt_password }}"

  - name: Provisioning a single machine
    include_tasks: single_provision.yml
    when: single_machine | bool

  - name: Provisioning a sequence of machines
    include_tasks: sequence_provision.yml
    when: not (single_machine | bool)

  always:
  - name: Always revoke the SSO token
    ovirt_auth:
      state: absent
      ovirt_auth: "{{ ovirt_auth }}"

